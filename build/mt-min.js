/*!
*  Mt JS is small JavaScript RIA library
*  Licence MIT
*  Author: Mikhail Tatsky - JavaScript Arhitect
*  http://ru.linkedin.com/pub/mikhail-tatsky/4b/69a/804/
*  Connect with me if want to hire
*/
"use strict";var Mt={global:this,version:"0.0.2"};Mt.apply=function(c,b){for(var a in b){c[a]=b[a]}};Mt.applyIf=function(c,b){for(var a in b){if(c[a]===undefined){c[a]=b[a]}}};Mt.namespace=function(){var d=0,a=arguments.length;for(;d<a;d++){var f=arguments[d],g=f.split("."),c=1,b=g.length;Mt.global[g[0]]=Mt.global[g[0]]||{};var e=Mt.global[g[0]];for(;c<b;c++){e[g[c]]=e[g[c]]||{};e=e[g[c]]}}};Mt.ns=Mt.namespace;Mt.typeOf=function(b){if(b===null){return"null"}var a=typeof b;if(a==="undefined"||a==="string"||a==="number"||a==="boolean"){return a}var c=Object.prototype.toString,d=c.call(b);switch(d){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}if(a==="function"){return"function"}if(a==="object"){return"object"}};Mt.isArray=("isArray" in Array)?Array.isArray:function(a){var b=Object.prototype.toString;return b.call(a)==="[object Array]"};Mt.isObject=function(a){var b=Object.prototype.toString;return b.call(a)==="[object Object]"};Mt.isFunction=function(a){var b=Object.prototype.toString;return b.apply(a)==="[object Function]"};Mt.isString=function(a){return typeof a==="string"};Mt.isBoolean=function(a){return typeof a==="boolean"};Mt.each=function(g,f){var c=g,e=Mt.typeOf(g);switch(e){case"array":var d=0,b=c.length;for(;d<b;d++){f(g[d],d,g)}break;case"object":var h;for(h in g){f(g[h],h,g)}break}};Mt.trait=function(f,m){if(m.classes){var e=0,c=m.classes,a=c.length;if(Mt.typeOf(m.classes[0])==="object"){for(;e<a;e++){var n=c[e],g=n._class,b=n.methods,d=0,l=b.length;for(;d<l;d++){var k=b[d];f[k]=g.prototype[k]}}}else{for(;e<a;e++){Mt.apply(f,c[e]["prototype"])}}}if(m.methods){var e=0,b=m.methods,a=b.length,h;for(;e<a;e++){h=b[e];f[h.name]=h.method}}};Mt.applyConfig=function(b,a){var c,a=a||{};if(b._isConfigApplied===true){return b}for(c in a){b[c]=a[c]}b._isConfigApplied=true;return b};Mt.Collection=function(a){var d=this;d.items=[];d.keys=[];d.map={};d.indexMap={};d.length=0;if(a){if(a.length>0){var c=0,b=a.length;for(;c<b;c++){d.add(c,a[c])}}else{for(var e in a){d.add(e,a[e])}}}};Mt.Collection.prototype={add:function(a,c){var b=this;b.items.push(c);b.keys.push(a);b.map[a]=c;b.indexMap[a]=b.length;b.length++},remove:function(b){var c=this,a=c.indexMap[b];c.items.splice(a,1);c.keys.splice(a,1);delete c.indexMap[a];delete c.map[b];c.length--},removeAll:function(){var a=this;a.items=[];a.keys=[];a.indexMap={};a.map={};a.length=0},get:function(a){var b=this;return b.map[a]},each:function(c){var d=this,b=0,a=d.length;for(;b<a;b++){c(d.keys[b],d.items[b],b,d.length)}}};(function(){var c={},b={};var d=function(f,e){for(var g in e.prototype){if(f.prototype[g]===undefined){f.prototype[g]=e.prototype[g]}}};var a=function(){};a.prototype={items:new Mt.Collection(),add:function(g,j){var k=g.split("."),f=1,e=k.length-1;Mt.ns(g);var h=Mt.global[k[0]];for(;f<e;f++){h=h[k[f]]}if(k.length>1){h[k[k.length-1]]=j}else{Mt.global[k[0]]=j}this.items.add(g,j)},get:function(e){return this.items.get(e)}};Mt.ClassManager=new a();Mt.Class=function(g,f){var f=f||{},j=[];if(Mt.isArray(g)){j=g;g=j[0]}if(f.constructor===Object){if(f.extend===undefined){f.constructor=function(){}}else{f.constructor=function(){this.Super("constructor",arguments)}}}if(f.extend===undefined){c[g]=f.constructor}else{c[g]=f.constructor;var e;switch(typeof f.extend){case"string":e=Mt.ClassManager.get(f.extend);c[g].prototype.$Super=Mt.ClassManager.get(f.extend);break;case"function":e=f.extend;c[g].prototype.$Super=f.extend;break}delete f.extend;c[g].prototype.Super=function(m,k){var l=this;if(l.$Iam){l.$Iam=Mt.ClassManager.get(l.$Iam.prototype.$Super.prototype.$name)}else{l.$Iam=Mt.ClassManager.get(l.$Super.prototype.$name)}switch(m){case"const":case"constructor":l.$Iam.apply(l,k);break;default:l.$Iam.prototype[m].apply(l,k)}delete l.$Iam};d(c[g],e)}c[g].prototype.$name=g;if(f.traits){Mt.trait(c[g].prototype,f.traits);delete c[g].prototype.traits}if(f.plugins!==undefined){c[g].prototype._plugins=c[g].prototype._plugins.concat(f.plugins);delete c[g].prototype.plugins}for(var i in f){c[g].prototype[i]=f[i]}var h=c[g];if(f.singleton===true){delete c[g];h=new h(f);c[g]=h}if(j.length>1){Mt.each(j,function(k){Mt.ClassManager.add(k,h)})}else{Mt.ClassManager.add(g,h)}if(f.type){b[f.type]=h;Mt.addWidgetType(f.type,h)}else{if(f.ptype){b[f.type]=h;Mt.addPlugin(f.ptype,h)}}};Mt.getClassByType=function(e){return b[e]}})();Mt.Class("Mt.Data",{constructor:function(d){var c=this;c.map={};if(d){var a=0,b=d.length,e=c.map;for(;a<b;a++){e[a]=d[a]}}c.length=0},add:function(a,c){var b=this;b.map[a]=c;b.length++},get:function(a){return this.map[a]}});Mt.Class("Mt.PluginManager",{singleton:true,constructor:function(){var a=this;a.ptypes=new Mt.Data()},addPlugin:function(b,a){this.ptypes.add(b,a)},getPlugin:function(a){return this.ptypes.get(a)}});Mt.addPlugin=function(b,a){Mt.PluginManager.addPlugin(b,a)};Mt.getWidget=function(a){return Mt.PluginManager.getPlugin(a)};Mt.Class("Mt.Observable",{constructor:function(c){var g=this,c=c||{};Mt.applyConfig(g,c);g.events={};if(g.listeners){var h=g.listeners,e=0,b=h.length;for(;e<b;e++){var l=h[e],f=null,k=null,j=null,d=[];for(var a in l){if(a==="scope"){j=l[a]}else{if(a==="params"){d=l[a]}else{f=a;k=l[a]}}}if(f===null||Mt.isFunction(k)===false){throw new Error("Event was not set")}if(Mt.isArray(d)===false){throw new Error("params must be array")}g.addEvent(f);g.on(f,k,j,d)}}},on:function(a,c,b,d){if(this.events[a]===undefined){console.log(arguments);throw new Error("Event name is not set: "+a)}this.events[a].push({fn:c,scope:b,params:d||[]})},un:function(a,d){var f=this,g=f.events[a];if(!g){return false}var c=0,e=g.length;for(;c<e;c++){var b=g[c];if(b.fn===d){g.splice(c,1);return true}}return false},once:function(a,c,b){var e=this,d=function(){c.apply(this,arguments);e.un(a,d)};e.on(a,d,b)},unAll:function(){this.events={}},unAllByType:function(a){this.events[a]=[]},fireEvent:function(b){var g=this,h=g.events[b];if(!h){return false}var e=1,f=arguments.length,d=[g];for(;e<f;e++){d.push(arguments[e])}var e=0,f=h.length;for(;e<f;e++){var c=h[e],a=[];a=a.concat(d);if(c.params){a=a.concat(c.params)}c.fn.apply(c.scope||g,a)}},addEvent:function(a){var b=this;b.events[a]=b.events[a]||[]},addEvents:function(b){var e=this;if(arguments.length>1){var a=[],c=0,d=arguments.length;for(;c<d;c++){a[c]=arguments[c]}b=a}if(Mt.typeOf(b)==="string"){e.events[b]=e.events[b]||[]}else{if(Mt.typeOf(b)==="array"){var c=0,d=b.length;for(;c<d;c++){e.events[b[c]]=e.events[b[c]]||[]}}}},has:function(a){var b=this.events[a];if(!b){return false}return b.length!==0}});